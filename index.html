<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>StockSense - Inventario Inteligente</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    /* Header mejorado con botones m√°s peque√±os */
    .topbar {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 12px 20px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 15px;
    }

    .topbar h1 {
      font-size: 1.5rem;
      color: #2c3e50;
      margin: 0;
    }

    .controls {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* Inputs y selects m√°s peque√±os */
    #searchInput, #filterAlert, #themeSelect {
      padding: 6px 12px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.85rem;
      min-width: 120px;
      height: 32px;
    }

    #searchInput {
      min-width: 180px;
    }

    /* Botones m√°s peque√±os */
    .btn {
      padding: 6px 14px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      font-weight: 500;
      transition: all 0.2s ease;
      height: 32px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .btn.primary {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      color: white;
    }

    .btn.primary:hover {
      background: linear-gradient(135deg, #4338ca, #6d28d9);
      transform: translateY(-1px);
    }

    .btn.ghost {
      background: transparent;
      border: 1px solid #ddd;
      color: #666;
    }

    .btn.ghost:hover {
      background: #f8f9fa;
      border-color: #4f46e5;
      color: #4f46e5;
    }

    .btn.danger {
      background: #ef4444;
      color: white;
    }

    .btn.danger:hover {
      background: #dc2626;
    }

    /* Contenedor principal */
    .wrap {
      max-width: 1200px;
      margin: 20px auto;
      padding: 0 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .hidden {
      display: none;
    }

    /* Formulario con campos mejor alineados */
    .form-group {
      margin-bottom: 24px;
    }

    .form-group h3 {
      color: #2c3e50;
      margin-bottom: 16px;
      font-size: 1.1rem;
      border-bottom: 2px solid #f1f5f9;
      padding-bottom: 8px;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      align-items: end;
    }

    .form-row > div {
      display: flex;
      flex-direction: column;
    }

    .form-row label {
      font-weight: 500;
      color: #374151;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }

    .form-row input, .form-row select {
      padding: 10px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 0.95rem;
      transition: border-color 0.2s ease;
      height: 42px;
    }

    .form-row input:focus, .form-row select:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }

    /* Acciones del formulario */
    .form-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #f1f5f9;
    }

    /* Grid de productos */
    .products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .product-card {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 1px solid #e2e8f0;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s ease;
    }

    .product-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border-color: #4f46e5;
    }

    .prod-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .prod-name {
      font-size: 1.1rem;
      color: #1e293b;
      margin: 0;
    }

    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #10b981;
    }

    .status-dot.alert {
      background: #ef4444;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .prod-stock {
      font-size: 0.9rem;
      color: #64748b;
      margin-bottom: 8px;
    }

    .stock-bar {
      background: #e2e8f0;
      height: 6px;
      border-radius: 3px;
      margin-bottom: 16px;
      overflow: hidden;
    }

    .stock-fill {
      height: 100%;
      background: linear-gradient(90deg, #10b981, #34d399);
      transition: width 0.3s ease;
    }

    .stock-fill.low {
      background: linear-gradient(90deg, #ef4444, #f87171);
    }

    .prod-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .prod-actions .btn {
      font-size: 0.8rem;
      padding: 4px 8px;
      height: 28px;
    }

    /* Estado vac√≠o */
    .empty {
      text-align: center;
      color: #64748b;
      font-style: italic;
      padding: 40px;
      background: #f8fafc;
      border-radius: 8px;
      border: 2px dashed #cbd5e1;
    }

    /* Secciones adicionales */
    #historySection, #reportsSection {
      margin-top: 20px;
    }

    #stockChart, #salesChart {
      max-width: 100%;
      height: 300px;
      margin: 20px 0;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .topbar {
        flex-direction: column;
        align-items: stretch;
      }

      .controls {
        justify-content: center;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .form-actions {
        justify-content: center;
      }

      .products {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <h1>üì¶ Inventario Inteligente</h1>
    <div class="controls">
      <input id="searchInput" type="text" placeholder="Buscar productos..." />
      <select id="filterAlert">
        <option value="all">Todos</option>
        <option value="alert">En alerta</option>
      </select>
      <select id="themeSelect">
        <option value="acero">Acero & Energ√≠a</option>
        <option value="oscuro">Oscuro minimalista</option>
        <option value="claro">Claro</option>
      </select>
      <button id="addProductBtn" class="btn primary">‚ûï Nuevo</button>
    </div>
  </header>

  <main class="wrap">
    <!-- Formulario producto -->
    <section id="formContainer" class="card hidden">
      <h2 id="formTitle">Nuevo producto</h2>
      <form id="productForm">
        <input type="hidden" id="productIndex" />

        <div class="form-group">
          <h3>Datos b√°sicos</h3>
          <div class="form-row">
            <div>
              <label>Nombre</label>
              <input type="text" id="prodName" required />
            </div>
            <div>
              <label>C√≥digo</label>
              <input type="text" id="prodCode" />
            </div>
            <div>
              <label>Categor√≠a</label>
              <input type="text" id="prodCategory" />
            </div>
            <div>
              <label>Proveedor</label>
              <input type="text" id="prodSupplier" />
            </div>
          </div>
        </div>

        <div class="form-group">
          <h3>Stock y precios</h3>
          <div class="form-row">
            <div>
              <label>Stock actual</label>
              <input type="number" id="prodStock" required />
            </div>
            <div>
              <label>Stock m√≠nimo</label>
              <input type="number" id="prodMin" required />
            </div>
            <div>
              <label>Precio compra</label>
              <input type="number" id="prodBuy" step="0.01" />
            </div>
            <div>
              <label>Precio venta</label>
              <input type="number" id="prodSell" step="0.01" />
            </div>
          </div>
        </div>

        <div class="form-group">
          <h3>Multimedia</h3>
          <div class="form-row">
            <div>
              <label>Foto</label>
              <input type="file" id="prodPhoto" accept="image/*" />
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn primary">üíæ Guardar</button>
          <button type="button" id="cancelBtn" class="btn ghost">Cancelar</button>
        </div>
      </form>
    </section>

    <!-- Lista de productos -->
    <section id="productList" class="card">
      <h2>Inventario</h2>
      <div id="products" class="products"></div>
      <div id="emptyState" class="empty">Sin productos a√∫n.</div>
    </section>

    <!-- Historial -->
    <section id="historySection" class="card">
      <h2>Historial de movimientos</h2>
      <div id="history"></div>
    </section>

    <!-- Reportes -->
    <section id="reportsSection" class="card">
      <h2>Reportes</h2>
      <canvas id="stockChart"></canvas>
      <canvas id="salesChart"></canvas>
    </section>
  </main>

  <template id="productCardTpl">
    <article class="product-card">
      <div class="prod-header">
        <h3 class="prod-name"></h3>
        <span class="status-dot"></span>
      </div>
      <p class="prod-stock"></p>
      <div class="stock-bar"><div class="stock-fill"></div></div>
      <div class="prod-actions">
        <button class="btn ghost edit">‚úèÔ∏è Editar</button>
        <button class="btn ghost moveIn">‚¨ÜÔ∏è Entrada</button>
        <button class="btn ghost moveOut">‚¨áÔ∏è Salida</button>
        <button class="btn danger delete">üóë Eliminar</button>
      </div>
    </article>
  </template>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Funcionalidad b√°sica del inventario
    class InventoryManager {
      constructor() {
        this.products = JSON.parse(localStorage.getItem('inventory') || '[]');
        this.history = JSON.parse(localStorage.getItem('inventory-history') || '[]');
        this.init();
      }

      init() {
        this.bindEvents();
        this.renderProducts();
        this.renderHistory();
      }

      bindEvents() {
        document.getElementById('addProductBtn').addEventListener('click', () => this.showForm());
        document.getElementById('cancelBtn').addEventListener('click', () => this.hideForm());
        document.getElementById('productForm').addEventListener('submit', (e) => this.saveProduct(e));
        document.getElementById('searchInput').addEventListener('input', (e) => this.filterProducts(e.target.value));
        document.getElementById('filterAlert').addEventListener('change', (e) => this.filterByAlert(e.target.value));
      }

      showForm(product = null, index = null) {
        const form = document.getElementById('formContainer');
        const title = document.getElementById('formTitle');
        
        if (product) {
          title.textContent = 'Editar producto';
          document.getElementById('productIndex').value = index;
          document.getElementById('prodName').value = product.name;
          document.getElementById('prodCode').value = product.code || '';
          document.getElementById('prodCategory').value = product.category || '';
          document.getElementById('prodSupplier').value = product.supplier || '';
          document.getElementById('prodStock').value = product.stock;
          document.getElementById('prodMin').value = product.minStock;
          document.getElementById('prodBuy').value = product.buyPrice || '';
          document.getElementById('prodSell').value = product.sellPrice || '';
        } else {
          title.textContent = 'Nuevo producto';
          document.getElementById('productForm').reset();
          document.getElementById('productIndex').value = '';
        }
        
        form.classList.remove('hidden');
      }

      hideForm() {
        document.getElementById('formContainer').classList.add('hidden');
      }

      saveProduct(e) {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const index = document.getElementById('productIndex').value;
        
        const product = {
          name: formData.get('prodName') || document.getElementById('prodName').value,
          code: document.getElementById('prodCode').value,
          category: document.getElementById('prodCategory').value,
          supplier: document.getElementById('prodSupplier').value,
          stock: parseInt(document.getElementById('prodStock').value),
          minStock: parseInt(document.getElementById('prodMin').value),
          buyPrice: parseFloat(document.getElementById('prodBuy').value) || 0,
          sellPrice: parseFloat(document.getElementById('prodSell').value) || 0,
          lastUpdate: new Date().toISOString()
        };

        if (index !== '') {
          this.products[index] = product;
          this.addToHistory(`Producto "${product.name}" actualizado`);
        } else {
          this.products.push(product);
          this.addToHistory(`Producto "${product.name}" creado`);
        }

        this.saveToStorage();
        this.renderProducts();
        this.hideForm();
      }

      deleteProduct(index) {
        if (confirm('¬øEst√°s seguro de eliminar este producto?')) {
          const product = this.products[index];
          this.products.splice(index, 1);
          this.addToHistory(`Producto "${product.name}" eliminado`);
          this.saveToStorage();
          this.renderProducts();
        }
      }

      moveStock(index, type) {
        const quantity = prompt(`Ingresa la cantidad para ${type === 'in' ? 'entrada' : 'salida'}:`);
        if (quantity && !isNaN(quantity)) {
          const product = this.products[index];
          const oldStock = product.stock;
          
          if (type === 'in') {
            product.stock += parseInt(quantity);
          } else {
            product.stock = Math.max(0, product.stock - parseInt(quantity));
          }
          
          this.addToHistory(`${product.name}: ${oldStock} ‚Üí ${product.stock} (${type === 'in' ? '+' : '-'}${quantity})`);
          this.saveToStorage();
          this.renderProducts();
        }
      }

      renderProducts() {
        const container = document.getElementById('products');
        const empty = document.getElementById('emptyState');
        
        if (this.products.length === 0) {
          container.innerHTML = '';
          empty.style.display = 'block';
          return;
        }
        
        empty.style.display = 'none';
        container.innerHTML = '';
        
        this.products.forEach((product, index) => {
          const card = this.createProductCard(product, index);
          container.appendChild(card);
        });
      }

      createProductCard(product, index) {
        const template = document.getElementById('productCardTpl');
        const card = template.content.cloneNode(true);
        
        card.querySelector('.prod-name').textContent = product.name;
        card.querySelector('.prod-stock').textContent = `Stock: ${product.stock} / M√≠n: ${product.minStock}`;
        
        const fillPercent = Math.min(100, (product.stock / (product.minStock * 2)) * 100);
        const fill = card.querySelector('.stock-fill');
        fill.style.width = fillPercent + '%';
        
        const statusDot = card.querySelector('.status-dot');
        if (product.stock <= product.minStock) {
          statusDot.classList.add('alert');
          fill.classList.add('low');
        }
        
        // Event listeners
        card.querySelector('.edit').addEventListener('click', () => this.showForm(product, index));
        card.querySelector('.delete').addEventListener('click', () => this.deleteProduct(index));
        card.querySelector('.moveIn').addEventListener('click', () => this.moveStock(index, 'in'));
        card.querySelector('.moveOut').addEventListener('click', () => this.moveStock(index, 'out'));
        
        return card;
      }

      addToHistory(action) {
        this.history.unshift({
          action,
          timestamp: new Date().toLocaleString('es-ES')
        });
        
        // Mantener solo los √∫ltimos 50 registros
        this.history = this.history.slice(0, 50);
        localStorage.setItem('inventory-history', JSON.stringify(this.history));
        this.renderHistory();
      }

      renderHistory() {
        const container = document.getElementById('history');
        if (this.history.length === 0) {
          container.innerHTML = '<p class="empty">No hay movimientos registrados.</p>';
          return;
        }
        
        container.innerHTML = this.history.slice(0, 10).map(entry => 
          `<div style="padding: 8px; border-bottom: 1px solid #eee;">
            <strong>${entry.timestamp}</strong><br>
            ${entry.action}
          </div>`
        ).join('');
      }

      filterProducts(searchTerm) {
        const cards = document.querySelectorAll('.product-card');
        cards.forEach(card => {
          const name = card.querySelector('.prod-name').textContent.toLowerCase();
          const visible = name.includes(searchTerm.toLowerCase());
          card.style.display = visible ? 'block' : 'none';
        });
      }

      filterByAlert(filter) {
        const cards = document.querySelectorAll('.product-card');
        cards.forEach((card, index) => {
          const hasAlert = card.querySelector('.status-dot').classList.contains('alert');
          const visible = filter === 'all' || (filter === 'alert' && hasAlert);
          card.style.display = visible ? 'block' : 'none';
        });
      }

      saveToStorage() {
        localStorage.setItem('inventory', JSON.stringify(this.products));
      }
    }

    // Inicializar la aplicaci√≥n
    new InventoryManager();
  </script>
</body>
</html>
